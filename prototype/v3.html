<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>大师兄 - 学术写作助手 v3</title>
<style>
  /* ============================================
     Design Tokens
     ============================================ */
  :root {
    --bg-primary: #000000;
    --bg-secondary: #1C1C1E;
    --bg-tertiary: #2C2C2E;
    --bg-elevated: #3A3A3C;

    --text-primary: #FFFFFF;
    --text-secondary: rgba(235, 235, 245, 0.6);
    --text-tertiary: rgba(235, 235, 245, 0.3);
    --text-placeholder: rgba(235, 235, 245, 0.3);

    --accent: #0A84FF;
    --accent-hover: #409CFF;
    --green: #30D158;
    --orange: #FF9F0A;
    --red: #FF453A;
    --yellow: #FFD60A;
    --purple: #BF5AF2;
    --teal: #40CBE0;
    --pink: #FF375F;

    --gray1: #8E8E93;
    --gray2: #636366;
    --gray3: #48484A;
    --gray4: #3A3A3C;
    --gray5: #2C2C2E;
    --gray6: #1C1C1E;

    --separator: rgba(84, 84, 88, 0.6);

    --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro", system-ui, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
    --font-mono: "SF Mono", SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;

    --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
    --space-5: 20px; --space-6: 24px; --space-8: 32px; --space-10: 40px;

    --radius-xs: 4px; --radius-sm: 6px; --radius-md: 10px;
    --radius-lg: 12px; --radius-xl: 16px; --radius-bubble: 18px;

    --duration-fast: 0.15s; --duration-normal: 0.3s;
    --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --ease-smooth: cubic-bezier(0.25, 0.1, 0.25, 1.0);

    --shelf-width: 280px;
    --titlebar-height: 52px;

    /* Bookshelf wood tones */
    --wood-bg: #1A1614;
    --wood-shelf: #3A302A;
    --wood-shelf-edge: #4A3F35;
    --wood-glow: rgba(255, 200, 120, 0.03);
  }

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; overflow: hidden; }

  body {
    font-family: var(--font-sans);
    font-size: 13px;
    line-height: 1.4;
    color: var(--text-primary);
    background: var(--bg-primary);
    -webkit-font-smoothing: antialiased;
  }

  /* ============================================
     App Shell
     ============================================ */
  .app {
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* ============================================
     LEFT: Bookshelf (书桌/书架)
     ============================================ */
  .bookshelf {
    width: var(--shelf-width);
    min-width: var(--shelf-width);
    background: var(--wood-bg);
    border-right: 1px solid rgba(60, 50, 40, 0.4);
    display: flex;
    flex-direction: column;
    user-select: none;
    position: relative;
    overflow: hidden;
  }

  /* Warm ambient light from above */
  .bookshelf::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 120px;
    background: radial-gradient(ellipse at 50% -20%, var(--wood-glow), transparent 70%);
    pointer-events: none;
    z-index: 1;
  }

  /* Titlebar */
  .shelf-titlebar {
    height: var(--titlebar-height);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--space-5);
    -webkit-app-region: drag;
    flex-shrink: 0;
    position: relative;
    z-index: 2;
  }

  .traffic-lights {
    display: flex;
    gap: 8px;
    -webkit-app-region: no-drag;
  }

  .traffic-light {
    width: 12px; height: 12px;
    border-radius: 50%;
    cursor: pointer;
    transition: opacity var(--duration-fast);
  }
  .traffic-light:hover { opacity: 0.8; }
  .traffic-light.close { background: #FF5F57; }
  .traffic-light.minimize { background: #FEBC2E; }
  .traffic-light.maximize { background: #28C840; }

  .shelf-title {
    font-size: 13px;
    font-weight: 600;
    color: rgba(200, 180, 160, 0.5);
    letter-spacing: 0.5px;
  }

  /* ============================================
     Shelves Container
     ============================================ */
  .shelves {
    flex: 1;
    overflow-y: auto;
    padding: 0 var(--space-3);
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
    z-index: 2;
  }

  .shelves::-webkit-scrollbar { width: 4px; }
  .shelves::-webkit-scrollbar-thumb { background: rgba(80, 70, 60, 0.3); border-radius: 2px; }

  /* ============================================
     Single Shelf
     ============================================ */
  .shelf {
    position: relative;
    padding-top: var(--space-2);
  }

  .shelf-label {
    font-size: 10px;
    font-weight: 600;
    color: rgba(200, 180, 160, 0.35);
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 0 var(--space-2) var(--space-1);
  }

  .shelf-items {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    padding: 0 var(--space-2);
    min-height: 120px;
    position: relative;
  }

  /* The shelf board */
  .shelf-board {
    height: 8px;
    background: linear-gradient(180deg, var(--wood-shelf), #2E2520);
    border-radius: 1px;
    position: relative;
    box-shadow:
      0 1px 0 rgba(255, 255, 255, 0.04) inset,
      0 4px 8px rgba(0, 0, 0, 0.5);
    margin: 0 var(--space-1);
  }

  /* Shelf front edge */
  .shelf-board::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0; right: 0;
    height: 4px;
    background: linear-gradient(180deg, var(--wood-shelf-edge), var(--wood-shelf));
    border-radius: 0 0 2px 2px;
  }

  /* ============================================
     3D Book
     ============================================ */
  .book {
    --c: #C94B3A;
    --w: 36px;
    --h: 130px;
    width: var(--w);
    height: var(--h);
    position: relative;
    cursor: pointer;
    border-radius: 2px 3px 3px 2px;
    background: linear-gradient(to right,
      color-mix(in srgb, var(--c) 82%, black),
      var(--c) 30%,
      color-mix(in srgb, var(--c) 88%, white) 65%,
      color-mix(in srgb, var(--c) 78%, black)
    );
    box-shadow:
      3px 0 0 color-mix(in srgb, var(--c) 55%, black),
      5px 2px 8px rgba(0, 0, 0, 0.5);
    transition: all 0.35s var(--ease-spring);
    flex-shrink: 0;
  }

  /* Page edges at top */
  .book::before {
    content: '';
    position: absolute;
    top: 2px; left: 3px; right: 5px;
    height: 2px;
    background: rgba(220, 210, 195, 0.5);
    border-radius: 1px;
  }

  .book:hover {
    transform: translateY(-14px) rotate(-3deg);
    box-shadow:
      3px 0 0 color-mix(in srgb, var(--c) 55%, black),
      8px 12px 24px rgba(0, 0, 0, 0.6);
    z-index: 5;
  }

  /* Active indicator (writing in progress) */
  .book.active::after {
    content: '';
    position: absolute;
    top: 8px; left: 50%;
    transform: translateX(-50%);
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent), 0 0 16px rgba(10, 132, 255, 0.3);
  }

  .book-title {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    position: absolute;
    top: 18px; bottom: 8px;
    left: 0; right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.85);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    overflow: hidden;
  }

  .book.thin .book-title {
    font-size: 9px;
    letter-spacing: 0.5px;
  }

  /* Book type label at bottom */
  .book-ext {
    position: absolute;
    bottom: 6px; left: 0; right: 0;
    text-align: center;
    font-size: 8px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.4);
    font-family: var(--font-mono);
  }

  /* Tooltip */
  .book[data-tip]:hover .book-tooltip,
  .shelf-folder[data-tip]:hover .book-tooltip,
  .pinned-chart[data-tip]:hover .book-tooltip {
    opacity: 1;
    transform: translateX(-50%) translateY(-4px);
    pointer-events: auto;
  }

  .book-tooltip {
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) translateY(4px);
    background: rgba(0, 0, 0, 0.92);
    color: var(--text-primary);
    font-size: 11px;
    padding: 5px 10px;
    border-radius: var(--radius-sm);
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: all 0.2s var(--ease-smooth);
    z-index: 20;
    font-weight: 400;
    letter-spacing: 0;
    writing-mode: horizontal-tb;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }

  .book-tooltip small {
    color: var(--text-tertiary);
    font-size: 10px;
    display: block;
    margin-top: 2px;
  }

  /* ============================================
     Folder on shelf
     ============================================ */
  .shelf-folder {
    --fc: #4A6A5C;
    width: 48px;
    height: 64px;
    position: relative;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.3s var(--ease-spring);
  }

  .shelf-folder:hover {
    transform: translateY(-8px);
    z-index: 5;
  }

  .folder-back {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 54px;
    background: var(--fc);
    border-radius: 2px 6px 4px 4px;
    box-shadow: 3px 2px 8px rgba(0, 0, 0, 0.4);
  }

  .folder-tab {
    position: absolute;
    top: 0; left: 0;
    width: 24px;
    height: 14px;
    background: var(--fc);
    border-radius: 4px 4px 0 0;
  }

  .folder-front {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 50px;
    background: color-mix(in srgb, var(--fc) 80%, white);
    border-radius: 0 4px 4px 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
  }

  .folder-label {
    font-size: 9px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.7);
    text-align: center;
    line-height: 1.2;
    padding: 0 4px;
  }

  .folder-count {
    position: absolute;
    top: 2px; right: -2px;
    min-width: 16px;
    height: 16px;
    background: var(--orange);
    color: black;
    font-size: 9px;
    font-weight: 700;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }

  /* ============================================
     Pinned chart/image on shelf
     ============================================ */
  .pinned-chart {
    width: 64px;
    height: 48px;
    background: var(--bg-tertiary);
    border-radius: 3px;
    overflow: hidden;
    box-shadow: 2px 3px 8px rgba(0, 0, 0, 0.4);
    transform: rotate(-2deg);
    cursor: pointer;
    transition: all 0.3s var(--ease-spring);
    position: relative;
    flex-shrink: 0;
  }

  .pinned-chart:hover {
    transform: rotate(0deg) translateY(-8px) scale(1.05);
    box-shadow: 4px 8px 16px rgba(0, 0, 0, 0.5);
    z-index: 5;
  }

  /* Pushpin */
  .pinned-chart::before {
    content: '';
    position: absolute;
    top: -4px; left: 50%;
    transform: translateX(-50%);
    width: 10px; height: 10px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 40%, #F06050, #C94030);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    z-index: 2;
  }

  .pinned-chart svg {
    width: 100%; height: 100%;
  }

  /* ============================================
     Bookshelf Footer (User)
     ============================================ */
  .shelf-footer {
    flex-shrink: 0;
    border-top: 1px solid rgba(60, 50, 40, 0.3);
    padding: var(--space-3) var(--space-4);
    position: relative;
    z-index: 2;
    background: rgba(26, 22, 20, 0.8);
    backdrop-filter: blur(10px);
  }

  .user-row {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .user-avatar {
    width: 34px; height: 34px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--purple));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
  }

  .user-detail { flex: 1; min-width: 0; }

  .user-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
  }

  .user-meta {
    font-size: 11px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .credits-pill {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    font-size: 11px;
    color: var(--green);
    background: rgba(48, 209, 88, 0.1);
    padding: 1px 7px;
    border-radius: 10px;
    font-weight: 500;
    cursor: pointer;
    transition: background var(--duration-fast);
  }
  .credits-pill:hover { background: rgba(48, 209, 88, 0.18); }

  .user-actions-row {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-1);
    margin-top: var(--space-2);
  }

  .icon-btn {
    width: 28px; height: 28px;
    border: none;
    background: transparent;
    color: rgba(200, 180, 160, 0.4);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--duration-fast);
  }
  .icon-btn:hover {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(200, 180, 160, 0.7);
  }

  /* ============================================
     RIGHT: Chat Area
     ============================================ */
  .chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-primary);
    min-width: 0;
  }

  .chat-header {
    height: var(--titlebar-height);
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-app-region: drag;
    flex-shrink: 0;
    position: relative;
    border-bottom: 1px solid rgba(84, 84, 88, 0.3);
  }

  .chat-header-center {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .avatar-sm {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: linear-gradient(135deg, #FF9F0A, #FF375F);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }

  .chat-header-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.2;
  }

  .chat-header-status {
    font-size: 11px;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .online-dot {
    width: 5px; height: 5px;
    border-radius: 50%;
    background: var(--green);
  }

  .model-pill {
    position: absolute;
    right: var(--space-5);
    -webkit-app-region: no-drag;
    font-size: 11px;
    color: var(--text-tertiary);
    background: var(--bg-secondary);
    border: 1px solid var(--gray3);
    border-radius: 20px;
    padding: 4px 12px;
    cursor: pointer;
    font-family: var(--font-sans);
    transition: all var(--duration-fast);
  }
  .model-pill:hover { border-color: var(--gray1); color: var(--text-secondary); }

  /* ============================================
     Messages Area
     ============================================ */
  .messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-6) var(--space-8);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .messages::-webkit-scrollbar { width: 8px; }
  .messages::-webkit-scrollbar-thumb { background: var(--gray3); border-radius: 4px; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .msg {
    display: flex;
    gap: var(--space-3);
    max-width: 75%;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
  }
  .msg.from-ai { align-self: flex-start; }
  .msg.from-user { align-self: flex-end; flex-direction: row-reverse; }

  .msg-avatar {
    width: 28px; height: 28px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    margin-top: 2px;
  }
  .msg.from-ai .msg-avatar { background: linear-gradient(135deg, #FF9F0A, #FF375F); }
  .msg.from-user .msg-avatar {
    background: linear-gradient(135deg, var(--accent), var(--purple));
    font-size: 11px; font-weight: 600; color: white;
  }

  .msg-body { min-width: 0; }

  .msg-name {
    font-size: 11px;
    color: var(--text-tertiary);
    margin-bottom: 3px;
    padding: 0 2px;
  }
  .msg.from-user .msg-name { text-align: right; }

  .bubble {
    padding: 10px 16px;
    border-radius: var(--radius-bubble);
    font-size: 14px;
    line-height: 1.55;
    word-wrap: break-word;
  }
  .msg.from-ai .bubble {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-top-left-radius: var(--radius-xs);
  }
  .msg.from-user .bubble {
    background: #0A84FF;
    color: white;
    border-top-right-radius: var(--radius-xs);
  }

  .msg-time {
    font-size: 10px;
    color: var(--text-tertiary);
    margin-top: 3px;
    padding: 0 2px;
  }
  .msg.from-user .msg-time { text-align: right; }

  .bubble strong { font-weight: 600; }
  .bubble code {
    font-family: var(--font-mono);
    font-size: 12px;
    background: rgba(255,255,255,0.08);
    padding: 2px 6px;
    border-radius: var(--radius-xs);
  }

  .divider {
    text-align: center;
    padding: var(--space-2) 0;
  }
  .divider span {
    font-size: 11px;
    color: var(--text-tertiary);
  }

  /* ============================================
     Think Block
     ============================================ */
  .think-block {
    align-self: flex-start;
    max-width: 75%;
    background: rgba(191, 90, 242, 0.04);
    border: 1px solid rgba(191, 90, 242, 0.1);
    border-radius: var(--radius-lg);
    overflow: hidden;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    transition: all 0.3s var(--ease-smooth);
  }

  .think-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-4);
    cursor: pointer;
    transition: background var(--duration-fast);
  }
  .think-header:hover { background: rgba(191, 90, 242, 0.06); }

  .think-header-left {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 13px;
    color: var(--purple);
    font-weight: 500;
  }

  .think-toggle {
    font-size: 11px;
    color: var(--text-tertiary);
    background: none;
    border: none;
    cursor: pointer;
    font-family: var(--font-sans);
    padding: 2px 8px;
    border-radius: var(--radius-xs);
    transition: all var(--duration-fast);
  }
  .think-toggle:hover { background: rgba(255,255,255,0.06); color: var(--text-secondary); }

  .think-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s var(--ease-smooth), padding 0.3s;
    padding: 0 var(--space-4);
  }

  .think-block.expanded .think-content {
    max-height: 400px;
    padding: 0 var(--space-4) var(--space-4);
  }

  .think-block.expanded .think-toggle { transform: rotate(180deg); }

  .think-text {
    font-size: 13px;
    line-height: 1.6;
    color: var(--text-secondary);
    border-top: 1px solid rgba(191, 90, 242, 0.08);
    padding-top: var(--space-3);
  }

  .think-text .think-step {
    display: flex;
    gap: var(--space-2);
    margin-bottom: var(--space-1);
  }

  .think-text .think-step::before {
    content: '·';
    color: var(--purple);
    font-weight: 700;
  }

  /* ============================================
     Decision Card (ask_user)
     ============================================ */
  .decision-card {
    align-self: flex-start;
    width: min(460px, 80%);
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    overflow: hidden;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.04);
  }

  .dc-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4) var(--space-5);
  }

  .dc-avatar {
    width: 24px; height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #FF9F0A, #FF375F);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
  }

  .dc-question {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .dc-options {
    padding: 0 var(--space-4) var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .dc-option {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    background: rgba(255, 255, 255, 0.03);
    border: 1.5px solid var(--gray3);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s var(--ease-smooth);
    text-align: left;
    font-family: var(--font-sans);
    color: var(--text-primary);
  }
  .dc-option:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--gray2);
    transform: translateX(3px);
  }

  .dc-option.selected {
    background: rgba(10, 132, 255, 0.08);
    border-color: var(--accent);
  }

  .dc-option.recommended {
    border-color: rgba(10, 132, 255, 0.3);
    background: rgba(10, 132, 255, 0.04);
  }

  /* Greyed-out unselected options after answer */
  .decision-card.answered .dc-option:not(.selected) {
    opacity: 0.35;
    pointer-events: none;
  }

  .dc-icon {
    width: 36px; height: 36px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.04);
  }

  .dc-opt-body { flex: 1; min-width: 0; }

  .dc-opt-title {
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .dc-opt-rec {
    font-size: 10px;
    color: var(--accent);
    background: rgba(10, 132, 255, 0.1);
    padding: 1px 6px;
    border-radius: 3px;
    font-weight: 600;
  }

  .dc-opt-desc {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 2px;
  }

  .dc-check {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 2px solid var(--gray3);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--duration-fast);
    font-size: 12px;
    color: transparent;
  }

  .dc-option.selected .dc-check {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  /* ============================================
     Code Block
     ============================================ */
  .code-card {
    align-self: flex-start;
    width: min(520px, 85%);
    background: #141416;
    border-radius: var(--radius-lg);
    overflow: hidden;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.06);
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-2) var(--space-4);
    background: rgba(255,255,255,0.03);
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }

  .code-filename {
    font-size: 12px;
    font-family: var(--font-mono);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .code-filename .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
  }
  .code-filename .dot.py { background: var(--yellow); }
  .code-filename .dot.json { background: var(--orange); }

  .code-copy {
    font-size: 11px;
    color: var(--text-tertiary);
    background: none;
    border: none;
    cursor: pointer;
    font-family: var(--font-sans);
    padding: 2px 8px;
    border-radius: var(--radius-xs);
    transition: all var(--duration-fast);
  }
  .code-copy:hover { background: rgba(255,255,255,0.08); color: var(--text-secondary); }

  .code-body {
    padding: var(--space-3) var(--space-4);
    overflow-x: auto;
  }

  .code-body pre {
    font-family: var(--font-mono);
    font-size: 12px;
    line-height: 1.7;
    color: #E0E0E0;
    margin: 0;
  }

  /* Syntax highlighting */
  .code-body .kw { color: #FF79C6; }
  .code-body .fn { color: #8BE9FD; }
  .code-body .str { color: #50FA7B; }
  .code-body .num { color: #FFB86C; }
  .code-body .cm { color: #6272A4; font-style: italic; }
  .code-body .op { color: #FF79C6; }
  .code-body .arg { color: #F8F8F2; }
  .code-body .cls { color: #8BE9FD; font-style: italic; }
  .code-body .dec { color: #50FA7B; }

  .code-lines {
    display: flex;
    gap: var(--space-4);
  }

  .code-line-nums {
    color: var(--gray2);
    text-align: right;
    user-select: none;
    font-family: var(--font-mono);
    font-size: 12px;
    line-height: 1.7;
  }

  /* ============================================
     Citation Card
     ============================================ */
  .cite-group {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    max-width: 85%;
    align-self: flex-start;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
  }

  .cite-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-3) var(--space-4);
    cursor: pointer;
    transition: all 0.2s var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.04);
    width: min(220px, 100%);
    flex-shrink: 0;
  }
  .cite-card:hover {
    background: var(--bg-tertiary);
    border-color: rgba(255,255,255,0.08);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .cite-source {
    font-size: 10px;
    color: var(--teal);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-bottom: 4px;
  }

  .cite-title {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-primary);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cite-meta {
    font-size: 11px;
    color: var(--text-tertiary);
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .cite-meta .cite-year {
    color: var(--text-secondary);
    font-weight: 500;
  }

  /* ============================================
     Step Indicator (TASK.md)
     ============================================ */
  .step-card {
    align-self: flex-start;
    max-width: 85%;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--space-3) var(--space-5);
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.04);
  }

  .step-card-title {
    font-size: 12px;
    color: var(--text-tertiary);
    margin-bottom: var(--space-3);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .steps {
    display: flex;
    align-items: center;
    gap: 0;
    flex-wrap: wrap;
  }

  .step {
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  .step-dot {
    width: 18px; height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    flex-shrink: 0;
  }

  .step.done .step-dot {
    background: var(--green);
    color: white;
  }
  .step.current .step-dot {
    background: var(--accent);
    color: white;
    box-shadow: 0 0 8px rgba(10, 132, 255, 0.4);
  }
  .step.pending .step-dot {
    background: var(--gray3);
    color: var(--text-tertiary);
  }

  .step-label {
    font-size: 12px;
    color: var(--text-tertiary);
    font-weight: 500;
  }
  .step.done .step-label { color: var(--text-secondary); }
  .step.current .step-label { color: var(--accent); }

  .step-arrow {
    color: var(--gray3);
    font-size: 10px;
    padding: 0 4px;
  }

  /* ============================================
     Status Card (refined)
     ============================================ */
  .status-card {
    align-self: stretch;
    max-width: 100%;
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    overflow: hidden;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.04);
  }

  .sc-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-4) var(--space-5);
  }

  .sc-title {
    font-size: 15px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .sc-badge {
    font-size: 11px;
    padding: 3px 10px;
    border-radius: 20px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .sc-badge.running { background: rgba(10,132,255,0.12); color: var(--accent); }
  .sc-badge.done    { background: rgba(48,209,88,0.12); color: var(--green); }

  .sc-body { padding: 0 var(--space-5) var(--space-4); }

  /* Metrics grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-3);
    margin-top: var(--space-3);
  }

  .metric-box {
    background: rgba(0,0,0,0.25);
    border-radius: var(--radius-md);
    padding: var(--space-3);
    text-align: center;
  }

  .metric-box-label {
    font-size: 10px;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-bottom: var(--space-1);
  }

  .metric-box-value {
    font-size: 20px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
    line-height: 1.2;
  }

  .metric-box-change {
    font-size: 11px;
    font-weight: 500;
    margin-top: 2px;
  }
  .metric-box-change.good { color: var(--green); }
  .metric-box-change.neutral { color: var(--text-tertiary); }

  /* Progress bar */
  .sc-progress { margin-top: var(--space-3); }

  .sc-progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 6px;
    font-weight: 500;
  }

  .sc-progress-bar {
    height: 6px;
    background: var(--gray3);
    border-radius: 3px;
    overflow: hidden;
  }

  .sc-progress-fill {
    height: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--accent), var(--teal));
    transition: width 0.8s var(--ease-smooth);
  }

  .sc-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-5);
    border-top: 1px solid rgba(255,255,255,0.04);
  }

  .sc-footer-left {
    font-size: 11px;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .pulse {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--green);
    position: relative;
  }
  .pulse::after {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 50%;
    background: var(--green);
    opacity: 0;
    animation: pulseAnim 2s ease-out infinite;
  }
  @keyframes pulseAnim {
    0% { opacity: 0.5; transform: scale(0.8); }
    100% { opacity: 0; transform: scale(2.2); }
  }

  .sc-btn {
    font-size: 12px;
    padding: 5px 14px;
    border-radius: 20px;
    border: none;
    cursor: pointer;
    font-family: var(--font-sans);
    font-weight: 500;
    transition: all var(--duration-fast);
  }
  .sc-btn.ghost {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--gray3);
  }
  .sc-btn.ghost:hover { border-color: var(--gray1); color: var(--text-primary); }
  .sc-btn.danger {
    background: rgba(255,69,58,0.12);
    color: var(--red);
  }
  .sc-btn.danger:hover { background: rgba(255,69,58,0.2); }

  .sc-footer-right { display: flex; gap: var(--space-2); }

  /* ============================================
     File Card (inline in chat)
     ============================================ */
  .file-card {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.2s var(--ease-smooth);
    max-width: 360px;
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
    border: 1px solid rgba(255,255,255,0.04);
  }
  .file-card:hover {
    background: var(--bg-tertiary);
    border-color: rgba(255,255,255,0.08);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .fc-icon {
    width: 40px; height: 40px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }
  .fc-icon.json { background: rgba(255,159,10,0.12); }
  .fc-icon.png  { background: rgba(191,90,242,0.12); }
  .fc-icon.tex  { background: rgba(48,209,88,0.12); }
  .fc-icon.pdf  { background: rgba(255,69,58,0.12); }
  .fc-icon.py   { background: rgba(255,214,10,0.12); }

  .fc-info { flex: 1; min-width: 0; }
  .fc-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .fc-meta {
    font-size: 11px;
    color: var(--text-tertiary);
  }
  .fc-open {
    font-size: 18px;
    color: var(--text-tertiary);
    transition: color var(--duration-fast);
    flex-shrink: 0;
  }
  .file-card:hover .fc-open { color: var(--accent); }

  /* ============================================
     Typing Indicator
     ============================================ */
  .typing {
    align-self: flex-start;
    display: flex;
    align-items: flex-end;
    gap: var(--space-3);
    animation: fadeUp var(--duration-normal) var(--ease-smooth);
  }
  .typing .msg-avatar { background: linear-gradient(135deg, #FF9F0A, #FF375F); }

  .typing-bubble {
    display: flex;
    gap: 5px;
    background: var(--bg-secondary);
    padding: 14px 18px;
    border-radius: var(--radius-bubble);
    border-top-left-radius: var(--radius-xs);
  }

  .t-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--text-tertiary);
    animation: bounce 1.4s infinite ease-in-out;
  }
  .t-dot:nth-child(1) { animation-delay: 0s; }
  .t-dot:nth-child(2) { animation-delay: 0.2s; }
  .t-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.35; }
    30% { transform: translateY(-5px); opacity: 1; }
  }

  /* ============================================
     Input Area
     ============================================ */
  .input-area {
    padding: var(--space-3) var(--space-8) var(--space-6);
    flex-shrink: 0;
  }

  .input-box {
    display: flex;
    align-items: flex-end;
    gap: var(--space-2);
    background: var(--bg-secondary);
    border: 1px solid var(--gray3);
    border-radius: 24px;
    padding: 6px 6px 6px var(--space-5);
    transition: border-color var(--duration-fast);
  }
  .input-box:focus-within { border-color: var(--accent); }

  .input-box textarea {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text-primary);
    font-family: var(--font-sans);
    font-size: 14px;
    line-height: 1.45;
    resize: none;
    min-height: 22px;
    max-height: 120px;
    padding: 5px 0;
  }
  .input-box textarea::placeholder { color: var(--text-placeholder); }

  .input-btns {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  .circle-btn {
    width: 34px; height: 34px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all var(--duration-fast);
  }
  .circle-btn.mic { background: transparent; color: var(--text-secondary); }
  .circle-btn.mic:hover { color: var(--text-primary); background: rgba(255,255,255,0.06); }
  .circle-btn.send { background: var(--accent); color: white; }
  .circle-btn.send:hover { background: var(--accent-hover); transform: scale(1.06); }

  .input-hint {
    text-align: center;
    font-size: 11px;
    color: var(--text-tertiary);
    margin-top: var(--space-2);
  }

  /* ============================================
     Spinner
     ============================================ */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    display: inline-block;
    border: 2px solid var(--gray3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
</style>
</head>
<body>

<div class="app">

  <!-- ============================================
       LEFT: Bookshelf (书架)
       ============================================ -->
  <aside class="bookshelf">
    <div class="shelf-titlebar">
      <div class="traffic-lights">
        <div class="traffic-light close"></div>
        <div class="traffic-light minimize"></div>
        <div class="traffic-light maximize"></div>
      </div>
      <span class="shelf-title">书架</span>
    </div>

    <div class="shelves">

      <!-- ===== Shelf: 论文 ===== -->
      <div class="shelf">
        <div class="shelf-label">论文</div>
        <div class="shelf-items">

          <div class="book active" style="--c:#C94B3A; --w:40px; --h:145px" data-tip>
            <span class="book-title">Agent 自进化论文</span>
            <span class="book-ext">.tex</span>
            <div class="book-tooltip">
              oae_paper.tex
              <small>撰写中 · 昨天 22:15</small>
            </div>
          </div>

          <div class="book" style="--c:#3A5A8C; --w:32px; --h:125px" data-tip>
            <span class="book-title">开题报告</span>
            <span class="book-ext">.md</span>
            <div class="book-tooltip">
              OPENING_REPORT.md
              <small>已完成 · 1月15日</small>
            </div>
          </div>

          <div class="book thin" style="--c:#5B8AB5; --w:20px; --h:110px" data-tip>
            <span class="book-title">大纲</span>
            <span class="book-ext">.md</span>
            <div class="book-tooltip">
              Paper_Outline.md
              <small>已完成 · 1月18日</small>
            </div>
          </div>

          <div class="book thin" style="--c:#7A6A9A; --w:18px; --h:100px" data-tip>
            <span class="book-title">引用</span>
            <span class="book-ext">.bib</span>
            <div class="book-tooltip">
              references.bib
              <small>42 篇 · 自动更新</small>
            </div>
          </div>

        </div>
        <div class="shelf-board"></div>
      </div>

      <!-- ===== Shelf: 实验 ===== -->
      <div class="shelf">
        <div class="shelf-label">实验</div>
        <div class="shelf-items">

          <div class="book" style="--c:#B8963A; --w:28px; --h:120px" data-tip>
            <span class="book-title">实验脚本</span>
            <span class="book-ext">.py</span>
            <div class="book-tooltip">
              oae_experiment.py
              <small>20 KB · 今天 14:35</small>
            </div>
          </div>

          <div class="book thin" style="--c:#9A8A3A; --w:18px; --h:95px" data-tip>
            <span class="book-title">绘图</span>
            <span class="book-ext">.py</span>
            <div class="book-tooltip">
              plot_results.py
              <small>5.4 KB · 今天 14:46</small>
            </div>
          </div>

          <div class="shelf-folder" style="--fc:#3A6A5C" data-tip>
            <div class="folder-back"></div>
            <div class="folder-tab"></div>
            <div class="folder-front">
              <span class="folder-label">实验<br>数据</span>
            </div>
            <div class="folder-count">3</div>
            <div class="book-tooltip">
              experiment_results.json 等
              <small>3 个文件 · 刚刚生成</small>
            </div>
          </div>

          <div class="pinned-chart" data-tip>
            <svg viewBox="0 0 64 48" fill="none">
              <polyline points="4,42 12,40 20,36 28,28 36,20 44,13 52,8 60,5" stroke="#30D158" stroke-width="1.5" fill="none" stroke-linecap="round"/>
              <polyline points="4,40 12,39 20,38 28,36 36,34 44,32 52,30 60,28" stroke="#636366" stroke-width="1" fill="none" stroke-dasharray="2 2"/>
              <polyline points="4,41 12,40 20,40 28,39 36,39 44,38 52,38 60,37" stroke="#48484A" stroke-width="1" fill="none" stroke-dasharray="2 2"/>
            </svg>
            <div class="book-tooltip">
              learning_curves.png
              <small>245 KB · 刚刚生成</small>
            </div>
          </div>

        </div>
        <div class="shelf-board"></div>
      </div>

      <!-- ===== Shelf: 调研 ===== -->
      <div class="shelf">
        <div class="shelf-label">调研</div>
        <div class="shelf-items">

          <div class="book" style="--c:#6B4A8C; --w:34px; --h:130px" data-tip>
            <span class="book-title">文献综述</span>
            <span class="book-ext">.md</span>
            <div class="book-tooltip">
              Literature_Review.md
              <small>42 篇文献 · 1月20日</small>
            </div>
          </div>

          <div class="book" style="--c:#4A5A8C; --w:26px; --h:115px" data-tip>
            <span class="book-title">研究计划</span>
            <span class="book-ext">.md</span>
            <div class="book-tooltip">
              RESEARCH_PLAN.md
              <small>已完成 · 1月16日</small>
            </div>
          </div>

          <div class="book thin" style="--c:#4A6A8C; --w:22px; --h:108px" data-tip>
            <span class="book-title">实验设计</span>
            <span class="book-ext">.md</span>
            <div class="book-tooltip">
              Experiment_Design.md
              <small>已完成 · 1月22日</small>
            </div>
          </div>

        </div>
        <div class="shelf-board"></div>
      </div>

    </div>

    <!-- Footer: user -->
    <div class="shelf-footer">
      <div class="user-row">
        <div class="user-avatar">王</div>
        <div class="user-detail">
          <div class="user-name">王大爆</div>
          <div class="user-meta">
            <span>天津大学 · 硕士</span>
            <span class="credits-pill" title="点击充值">&#9889; 128</span>
          </div>
        </div>
      </div>
      <div class="user-actions-row">
        <button class="icon-btn" title="设置">&#9881;</button>
        <button class="icon-btn" title="记忆">&#128221;</button>
        <button class="icon-btn" title="帮助">?</button>
      </div>
    </div>
  </aside>

  <!-- ============================================
       RIGHT: Chat
       ============================================ -->
  <main class="chat">
    <div class="chat-header">
      <div class="chat-header-center">
        <div class="avatar-sm">&#127891;</div>
        <div>
          <div class="chat-header-name">大师兄</div>
          <div class="chat-header-status">
            <span class="online-dot"></span>
            在线
          </div>
        </div>
      </div>
      <button class="model-pill">Claude Opus 4.5 &#9662;</button>
    </div>

    <div class="messages">

      <div class="divider"><span>今天 14:30</span></div>

      <!-- AI welcome -->
      <div class="msg from-ai">
        <div class="msg-avatar">&#127891;</div>
        <div class="msg-body">
          <div class="msg-name">大师兄</div>
          <div class="bubble">王大爆，大师兄在。有活儿直接说。</div>
          <div class="msg-time">14:30</div>
        </div>
      </div>

      <!-- User -->
      <div class="msg from-user">
        <div class="msg-avatar">王</div>
        <div class="msg-body">
          <div class="msg-name">王大爆</div>
          <div class="bubble">帮我把论文的实验部分写了，先跑实验再写</div>
          <div class="msg-time">14:31</div>
        </div>
      </div>

      <!-- ===== Decision Card ===== -->
      <div class="decision-card answered">
        <div class="dc-header">
          <div class="dc-avatar">&#127891;</div>
          <div class="dc-question">先确认一下，论文格式用哪个？</div>
        </div>
        <div class="dc-options">
          <button class="dc-option recommended selected">
            <div class="dc-icon">&#128196;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">LaTeX <span class="dc-opt-rec">推荐</span></div>
              <div class="dc-opt-desc">投稿标准格式，公式和引用管理完美</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
          <button class="dc-option">
            <div class="dc-icon">&#128221;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">Markdown</div>
              <div class="dc-opt-desc">轻量快速，适合初稿和讨论</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
          <button class="dc-option">
            <div class="dc-icon">&#128203;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">Word (.docx)</div>
              <div class="dc-opt-desc">导师习惯 Word 批注审阅</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
        </div>
      </div>

      <!-- ===== Think Block (collapsed) ===== -->
      <div class="think-block" id="think1">
        <div class="think-header" onclick="toggleThink('think1')">
          <div class="think-header-left">
            &#128173; <span>思考了一下...</span>
          </div>
          <button class="think-toggle">&#9660;</button>
        </div>
        <div class="think-content">
          <div class="think-text">
            <div class="think-step">用户需要完整的实验章节，先跑实验再写论文</div>
            <div class="think-step">Baselines: PPO, DQN, Random — 需要对比 Time Efficiency, Accuracy, Evolution Effect</div>
            <div class="think-step">先写实验脚本 oae_experiment.py，配置 50 epochs</div>
            <div class="think-step">跑完后用 matplotlib 生成 learning curves</div>
            <div class="think-step">最后用 LaTeX 写 Section 5: Experiments</div>
            <div class="think-step">引用需要查 RL + Agent Evolution 方向的最新文献</div>
          </div>
        </div>
      </div>

      <!-- AI message -->
      <div class="msg from-ai">
        <div class="msg-avatar">&#127891;</div>
        <div class="msg-body">
          <div class="msg-name">大师兄</div>
          <div class="bubble">好，我来安排：先写实验脚本 → 跑对比实验 → 生成图表 → 查文献 → 写实验章节。实验脚本写好了：</div>
          <div class="msg-time">14:32</div>
        </div>
      </div>

      <!-- ===== Step Indicator ===== -->
      <div class="step-card">
        <div class="step-card-title">&#128203; 实验章节进度</div>
        <div class="steps">
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">设计</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">代码</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step current">
            <div class="step-dot">3</div>
            <div class="step-label">训练</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step pending">
            <div class="step-dot">4</div>
            <div class="step-label">图表</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step pending">
            <div class="step-dot">5</div>
            <div class="step-label">文献</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step pending">
            <div class="step-dot">6</div>
            <div class="step-label">撰写</div>
          </div>
        </div>
      </div>

      <!-- ===== Code Block ===== -->
      <div class="code-card">
        <div class="code-header">
          <div class="code-filename">
            <span class="dot py"></span>
            oae_experiment.py
          </div>
          <button class="code-copy">复制</button>
        </div>
        <div class="code-body">
          <div class="code-lines">
            <div class="code-line-nums">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
            <pre><span class="kw">import</span> torch
<span class="kw">from</span> agents <span class="kw">import</span> <span class="cls">OAEAgent</span>, <span class="cls">PPOBaseline</span>, <span class="cls">DQNBaseline</span>

<span class="kw">def</span> <span class="fn">run_experiment</span>(epochs=<span class="num">50</span>, seed=<span class="num">42</span>):
    <span class="str">"""Run comparative experiment with baselines."""</span>
    env = <span class="fn">make_env</span>(<span class="str">"SkillEvolution-v2"</span>)
    models = {
        <span class="str">"OAE (Ours)"</span>: <span class="cls">OAEAgent</span>(env),
        <span class="str">"PPO"</span>: <span class="cls">PPOBaseline</span>(env),
        <span class="str">"DQN"</span>: <span class="cls">DQNBaseline</span>(env),
    }</pre>
          </div>
        </div>
      </div>

      <!-- AI update -->
      <div class="msg from-ai">
        <div class="msg-avatar">&#127891;</div>
        <div class="msg-body">
          <div class="msg-name">大师兄</div>
          <div class="bubble">脚本写好了，开跑。三个 baseline + 我们的方法，50 epochs：</div>
          <div class="msg-time">14:34</div>
        </div>
      </div>

      <!-- ===== Status Card: Running ===== -->
      <div class="status-card">
        <div class="sc-header">
          <div class="sc-title">&#128300; Agent 自进化对比实验</div>
          <div class="sc-badge running">
            <span class="spinner" style="width:10px;height:10px;border-width:1.5px;"></span>
            运行中
          </div>
        </div>
        <div class="sc-body">
          <div class="sc-progress">
            <div class="sc-progress-label">
              <span>Epoch 35 / 50</span>
              <span>70%</span>
            </div>
            <div class="sc-progress-bar">
              <div class="sc-progress-fill" style="width:70%;"></div>
            </div>
          </div>
          <div class="metrics-grid">
            <div class="metric-box">
              <div class="metric-box-label">Loss</div>
              <div class="metric-box-value">0.083</div>
              <div class="metric-box-change good">&darr; 0.259</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">Accuracy</div>
              <div class="metric-box-value">86.1%</div>
              <div class="metric-box-change good">&uarr; 19.8%</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">LR</div>
              <div class="metric-box-value">1e-4</div>
              <div class="metric-box-change neutral">cosine</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">用时</div>
              <div class="metric-box-value">5:28</div>
              <div class="metric-box-change neutral">~8 min</div>
            </div>
          </div>
        </div>
        <div class="sc-footer">
          <div class="sc-footer-left">
            <div class="pulse"></div>
            <span>实时更新 · 0 errors</span>
          </div>
          <div class="sc-footer-right">
            <button class="sc-btn ghost">查看日志</button>
            <button class="sc-btn danger">停止</button>
          </div>
        </div>
      </div>

      <!-- Think block expanded -->
      <div class="think-block expanded" id="think2">
        <div class="think-header" onclick="toggleThink('think2')">
          <div class="think-header-left">
            &#128173; <span>在想下一步...</span>
          </div>
          <button class="think-toggle">&#9660;</button>
        </div>
        <div class="think-content">
          <div class="think-text">
            <div class="think-step">训练快结束了，Loss 下降趋势好，Accuracy 稳步上升</div>
            <div class="think-step">DQN replay buffer 有个 warning，但不影响结果，已 catch</div>
            <div class="think-step">跑完后先出 learning curves (matplotlib, 3 条线 + legend)</div>
            <div class="think-step">然后查 Perplexity 找 3-5 篇相关文献作为对比引用</div>
          </div>
        </div>
      </div>

      <div class="divider"><span>14:42</span></div>

      <!-- ===== Status Card: Done ===== -->
      <div class="status-card">
        <div class="sc-header">
          <div class="sc-title">&#128300; Agent 自进化对比实验</div>
          <div class="sc-badge done">&#10003; 完成</div>
        </div>
        <div class="sc-body">
          <div class="metrics-grid">
            <div class="metric-box">
              <div class="metric-box-label">最终 Loss</div>
              <div class="metric-box-value">0.043</div>
              <div class="metric-box-change good">&darr; 最佳</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">Accuracy</div>
              <div class="metric-box-value">94.7%</div>
              <div class="metric-box-change good">&uarr; 全面超越</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">Evolution</div>
              <div class="metric-box-value">+31%</div>
              <div class="metric-box-change good">显著提升</div>
            </div>
            <div class="metric-box">
              <div class="metric-box-label">总用时</div>
              <div class="metric-box-value">7:53</div>
              <div class="metric-box-change neutral">50 epochs</div>
            </div>
          </div>
        </div>
      </div>

      <!-- AI message -->
      <div class="msg from-ai">
        <div class="msg-avatar">&#127891;</div>
        <div class="msg-body">
          <div class="msg-name">大师兄</div>
          <div class="bubble">跑完了，三项指标全面超越 baseline。图表已生成，查了几篇相关文献：</div>
          <div class="msg-time">14:42</div>
        </div>
      </div>

      <!-- ===== Citation Cards ===== -->
      <div class="cite-group">
        <div class="cite-card">
          <div class="cite-source">NeurIPS 2024</div>
          <div class="cite-title">Voyager: An Open-Ended Embodied Agent with Large Language Models</div>
          <div class="cite-meta">
            <span class="cite-year">Wang et al.</span>
            <span>&#183;</span>
            <span>Cited 847</span>
          </div>
        </div>
        <div class="cite-card">
          <div class="cite-source">Nature 2016</div>
          <div class="cite-title">Mastering the game of Go with deep neural networks and tree search</div>
          <div class="cite-meta">
            <span class="cite-year">Silver et al.</span>
            <span>&#183;</span>
            <span>Cited 21K</span>
          </div>
        </div>
        <div class="cite-card">
          <div class="cite-source">ICML 2023</div>
          <div class="cite-title">LATS: Language Agent Tree Search Unifies Reasoning Acting Planning</div>
          <div class="cite-meta">
            <span class="cite-year">Zhou et al.</span>
            <span>&#183;</span>
            <span>Cited 312</span>
          </div>
        </div>
      </div>

      <!-- File cards -->
      <div class="file-card">
        <div class="fc-icon json">&#128202;</div>
        <div class="fc-info">
          <div class="fc-name">experiment_results.json</div>
          <div class="fc-meta">12.4 KB · 刚刚生成</div>
        </div>
        <div class="fc-open">&rarr;</div>
      </div>

      <div class="file-card">
        <div class="fc-icon png">&#128200;</div>
        <div class="fc-info">
          <div class="fc-name">learning_curves.png</div>
          <div class="fc-meta">Accuracy 对比曲线 · 245 KB</div>
        </div>
        <div class="fc-open">&rarr;</div>
      </div>

      <!-- AI wrapping up -->
      <div class="msg from-ai">
        <div class="msg-avatar">&#127891;</div>
        <div class="msg-body">
          <div class="msg-name">大师兄</div>
          <div class="bubble">实验章节草稿写好了，放书架上了。LaTeX 格式，包含 3 个 table + 2 个 figure，引用了 5 篇文献。打开看看：</div>
          <div class="msg-time">14:45</div>
        </div>
      </div>

      <div class="file-card">
        <div class="fc-icon tex">&#128196;</div>
        <div class="fc-info">
          <div class="fc-name">oae_paper.tex</div>
          <div class="fc-meta">Section 5: Experiments 已更新</div>
        </div>
        <div class="fc-open">&rarr;</div>
      </div>

      <!-- Updated step indicator -->
      <div class="step-card">
        <div class="step-card-title">&#128203; 实验章节进度</div>
        <div class="steps">
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">设计</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">代码</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">训练</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">图表</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">文献</div>
          </div>
          <span class="step-arrow">&#8594;</span>
          <div class="step done">
            <div class="step-dot">&#10003;</div>
            <div class="step-label">撰写</div>
          </div>
        </div>
      </div>

      <!-- New decision card (active, unanswered) -->
      <div class="decision-card" id="dc2">
        <div class="dc-header">
          <div class="dc-avatar">&#127891;</div>
          <div class="dc-question">接下来做什么？</div>
        </div>
        <div class="dc-options">
          <button class="dc-option recommended" onclick="selectOption(this)">
            <div class="dc-icon">&#128221;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">接着写 Discussion <span class="dc-opt-rec">推荐</span></div>
              <div class="dc-opt-desc">趁热打铁，实验结果新鲜着写讨论</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
          <button class="dc-option" onclick="selectOption(this)">
            <div class="dc-icon">&#128269;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">补充消融实验</div>
              <div class="dc-opt-desc">跑 ablation study 验证各组件贡献</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
          <button class="dc-option" onclick="selectOption(this)">
            <div class="dc-icon">&#128064;</div>
            <div class="dc-opt-body">
              <div class="dc-opt-title">我先看看实验结果</div>
              <div class="dc-opt-desc">先审查数据和图表，再决定下一步</div>
            </div>
            <div class="dc-check">&#10003;</div>
          </button>
        </div>
      </div>

      <!-- Typing -->
      <div class="typing">
        <div class="msg-avatar">&#127891;</div>
        <div class="typing-bubble">
          <div class="t-dot"></div>
          <div class="t-dot"></div>
          <div class="t-dot"></div>
        </div>
      </div>

    </div>

    <div class="input-area">
      <div class="input-box">
        <textarea placeholder="和大师兄说点什么..." rows="1"></textarea>
        <div class="input-btns">
          <button class="circle-btn mic" title="语音输入">&#127908;</button>
          <button class="circle-btn send" title="发送">&uarr;</button>
        </div>
      </div>
      <div class="input-hint">Enter 发送 · Shift+Enter 换行</div>
    </div>
  </main>

</div>

<script>
  // Auto-scroll to bottom
  const messages = document.querySelector('.messages');
  messages.scrollTop = messages.scrollHeight;

  // Textarea auto-resize
  const ta = document.querySelector('.input-box textarea');
  ta.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
  });
  ta.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      if (this.value.trim()) { this.value = ''; this.style.height = 'auto'; }
    }
  });

  // Think block toggle
  function toggleThink(id) {
    document.getElementById(id).classList.toggle('expanded');
  }

  // Decision card selection
  function selectOption(btn) {
    const card = btn.closest('.decision-card');
    card.querySelectorAll('.dc-option').forEach(o => o.classList.remove('selected'));
    btn.classList.add('selected');
    card.classList.add('answered');
  }

  // Book click - open file
  document.querySelectorAll('.book, .shelf-folder, .pinned-chart').forEach(el => {
    el.addEventListener('click', () => {
      const tip = el.querySelector('.book-tooltip');
      if (tip) {
        const name = tip.childNodes[0]?.textContent?.trim();
        if (name) alert('用默认应用打开: ' + name);
      }
    });
  });
</script>

</body>
</html>
